# YAMLScript

We use YAML syntax to define a set of tasks declaratively, YAMLScript will help
you compile it into Javascript code that runs on Deno.

We can use YAMLScript to run task files directly:

```bash
ys run task.ys.yml
```

Or we can also deploy the compiled Javascript files to serverless services such
as [Deno Deploy](https://deno.com/deploy):

```bash
ys build task.ys.yml && deployctl deploy --project=helloworld ./dist/task.js
```

YAMLScript is designed to solve the most common problems with minimal knowledge.
It can be considered as an alternative for
[dotfiles utilities](https://dotfiles.github.io/utilities/) such as
[chezmoi](https://www.chezmoi.io/), or an alternative to automated workflows
such as [Ansible](https://www.ansible.com/), it can also be a low-code
alternative to [IFTTT](https://ifttt.com/), [Zapier](https://zapier.com/),
[Pipedream](https://pipedream.com/), etc.

In YAMLScript, The following interface is the only property we need to
understand, they are all optional.

```typescript
interface Task {
  id?: string;
  name?: string;
  from?: string;
  use?: string;
  args?: unknown | unknown[];
  loop?: string | number | unknown[];
  if?: boolean | string;
  catch?: boolean;
}
```

And the compiled Javascript code is human readable, so if anything goes wrong,
we can easily locate and fix it. If you run into problems, go to the compiled
Javascript code, which is located in the `dist` directory by default.

> This project is still in development, most things are already working.


## Simple Usage



```yaml
# Set Variables
# args is an object, key is variable name, value is variable value.
- use: def
  args:
    list:
      - Hello
      - true
    foo:
      cat: 10

```

This will be compiled to 

   
```javascript
export default async function main(){
  let result = null, index = undefined;
  let list = [`Hello`,true];
  let foo = {"cat":10};
  console.log("Task #0 done.");
}
if (import.meta.main) {
  main();
}
```


```yaml
# Print something
# We use js template string ${expression} for string interpolation, you can use any valid js template expression here, even function. ${} can be escaped as \$s{}
- use: console.log
  args:
    - ${list[0]} World
    - ${foo.cat}
    - ${JSON.stringify(foo)}

#

- use: console.log

```

This will be compiled to 

   
```javascript
export default async function main(){
  let result = null, index = undefined;
  result = await console.log(`${list[0]} World`,`${foo.cat}`,`${JSON.stringify(foo)}`);
  console.log("Task #0 done.");
  result = await console.log();
  console.log("Task #1 done.");
}
if (import.meta.main) {
  main();
}
```




## Install

1. Yamlscript depends on Deno, so you should install
   [Deno](https://deno.land/#installation) first.
2. Install YAMLScript by running
   `deno install -A https://deno.land/x/YAMLScript/ys.ts`.

## Notes

This README.md file is generated by the following YAMLScript.

```yaml
- id: readmeTemplate
  use: Deno.readTextFile
  args: ./README.template.md
- id: yamlMakeReadmeScript
  use: Deno.readTextFile
  args: ./docs/make_readme.ys.yml

- id: simpleUsageFiles
  use: Deno.readDir
  args: ./docs/simple-usage

- use: defn
  id: mapFiles
  args:
    - id: sourceContent
      use: Deno.readTextFile
      args: ${args[0]}
    - id: sourceTasks
      use: fsExtra.readYAMLFile
      args: ${args[0]}
    - id: targetCode
      use: YAMLScript.getCompiledCode
      args:
        - $sourceTasks
    - use: getArgs
      args:
        source: $sourceContent
        target: $targetCode.moduleFileCode

- id: simpleUsageSources
  loop: $simpleUsageFiles
  use: mapFiles
  args: ./docs/simple-usage/${item.name}

- id: readmeContent
  from: https://esm.sh/mustache@4.2.0
  use: default.render
  args:
    - $readmeTemplate
    - simpleUsageSources: $simpleUsageSources
      yamlMakeReadmeScript: $yamlMakeReadmeScript
- use: Deno.writeTextFile
  args:
    - README.md
    - $readmeContent

```

See all [built-in functions](/globals/mod.ts)
